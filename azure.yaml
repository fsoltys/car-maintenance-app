# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json

name: car-maintenance-app
metadata:
  template: car-maintenance-app@0.0.1-beta

variables:
  AZURE_ENV_NAME:
    type: string
    default: "carmaintenance"
  AZURE_LOCATION:
    type: string
    default: "polandcentral"

services:
  backend:
    project: ./backend
    host: appservice
    language: python
    module: main
    
    # Environment variables for the app service
    env:
      ENVIRONMENT: production
      DEBUG: false
      DB_HOST: car-maintenance-db.postgres.database.azure.com
      DB_PORT: 5432
      DB_NAME: car_maintenance_db
      DB_USER: carmaintenance
      # DB_PASSWORD: Will be set through Azure configuration
      # SECRET_KEY: Will be set through Azure configuration (NEVER commit secrets!)
      ACCESS_TOKEN_EXPIRE_MINUTES: 30
      ALGORITHM: HS256

hooks:
  preprovision:
    shell: pwsh
    run: |
      Write-Host "Preparing for deployment..."
      
  postprovision:
    shell: pwsh
    run: |
      Write-Host "Deployment completed!"
      Write-Host "API URL: https://$env:SERVICE_BACKEND_URI"
      Write-Host "Documentation: https://$env:SERVICE_BACKEND_URI/docs"
